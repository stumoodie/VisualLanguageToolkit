<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <class name="org.pathwayeditor.businessobjects.hibernate.pojos.HibCanvas" table="canvas">
        <id name="id" type="java.lang.Long">
            <column name="id" />
            <generator class="native" />
        </id>
        <properties name="xak1canvas" unique="true">
        	<many-to-one name="repository" class="org.pathwayeditor.businessobjects.hibernate.pojos.HibRepository" cascade="none">
            	<column name="repository_id" not-null="true" />
        	</many-to-one>
        	<property name="mapINode" type="int" access="property">
        		<column name="map_inode" not-null="true"/>
        	</property>
        </properties>

        <one-to-one name="model" property-ref="canvas" class="org.pathwayeditor.businessobjects.hibernate.pojos.HibModel" cascade="all"/>

        <many-to-one name="hibNotation" class="org.pathwayeditor.businessobjects.hibernate.pojos.HibNotation">
            <column name="context_id" not-null="true" />
        </many-to-one>

        <property name="gridX" type="int" access="property">
            <column name="grid_x" not-null="true" />
        </property>
        <property name="gridY" type="int" access="property">
            <column name="grid_y" not-null="true" />
        </property>
        <property name="gridEnabled" type="boolean" access="property">
            <column name="grid_enabled" not-null="true" />
        </property>
        <property name="snapToGridEnabled" type="boolean" access="property">
            <column name="snap_to_grid_enabled" not-null="true" />
        </property>
        <property name="backgroundRed" type="int" access="property">
            <column name="background_red" not-null="true" />
        </property>
        <property name="backgroundGreen" type="int" access="property">
            <column name="background_green" not-null="true" />
        </property>
        <property name="backgroundBlue" type="int" access="property">
            <column name="background_blue" not-null="true" />
        </property>
        <property name="canvasWidth" type="int" access="property">
            <column name="canvas_width" not-null="true" />
        </property>
        <property name="canvasHeight" type="int" access="property">
            <column name="canvas_height" not-null="true" />
        </property>
        <property name="created" type="java.util.Date">
        	<column name="created" not-null="true"/> 
        </property>
        <property name="modified" type="java.util.Date">
        	<column name="last_modified" not-null="true"/> 
        </property>
        <property name="lastCreationSerial" type="int" access="property">
        	<column name="last_creation_serial" not-null="true" />
        </property>
        <set name="shapeAttributes" inverse="true" table="shapeAttribute" cascade="all,delete-orphan">
            <key>
                <column name="canvas_id" not-null="true" />
            </key>
            <one-to-many class="org.pathwayeditor.businessobjects.hibernate.pojos.HibShapeAttribute"/> 
        </set>
        <set name="labelAttributes" inverse="true" table="labelAttribute" cascade="all,delete-orphan">
            <key>
                <column name="canvas_id" not-null="true" />
            </key>
            <one-to-many class="org.pathwayeditor.businessobjects.hibernate.pojos.HibLabelAttribute"/> 
        </set>
        <set name="linkAttributes" inverse="true" table="linkAttribute" cascade="all,delete-orphan">
            <key>
                <column name="canvas_id" not-null="true" />
            </key>
            <one-to-many class="org.pathwayeditor.businessobjects.hibernate.pojos.HibLinkAttribute"/>
        </set>     
    </class>
    
    <query name="canvasExistsForMap"><![CDATA[
    		select count(*) from HibCanvas c  where c.mapINode = :inode and c.repository = :repo
        ]]></query>
    <query name="loadCanvas"><![CDATA[
    		from HibCanvas c inner join fetch c.model m inner join fetch m.rootNode where c.repository = :repo and c.mapINode = :inode
    	]]></query>
    
</hibernate-mapping>
