<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <class name="org.pathwayeditor.businessobjects.hibernate.pojos.HibCanvas" table="canvas">
        <id name="id" type="java.lang.Long">
            <column name="id" />
            <generator class="native" />
        </id>
        <properties name="xak1canvas" unique="true">
        	<property name="repositoryName" type="string">
            	<column name="repository_name" not-null="true" />
        	</property>
        	<property name="mapINode" type="int" access="property">
        		<column name="map_inode" not-null="true"/>
        	</property>
        </properties>

        <one-to-one name="model" property-ref="canvas" class="org.pathwayeditor.businessobjects.hibernate.pojos.HibModel" cascade="all" lazy="false" />

        <many-to-one name="hibNotation" class="org.pathwayeditor.businessobjects.hibernate.pojos.HibNotation" lazy="false" >
            <column name="notation_id" not-null="true" />
        </many-to-one>

		<property name="name" type="string" access="property">
			<column name="name" not-null="true"/>
		</property>

        <property name="gridX" type="double" access="property">
            <column name="grid_x" not-null="true" />
        </property>
        <property name="gridY" type="double" access="property">
            <column name="grid_y" not-null="true" />
        </property>
        <property name="gridEnabled" type="boolean" access="property">
            <column name="grid_enabled" not-null="true" />
        </property>
        <property name="snapToGrid" type="boolean" access="property">
            <column name="snap_to_grid_enabled" not-null="true" />
        </property>
        <property name="backgroundRed" type="int" access="property">
            <column name="background_red" not-null="true" />
        </property>
        <property name="backgroundGreen" type="int" access="property">
            <column name="background_green" not-null="true" />
        </property>
        <property name="backgroundBlue" type="int" access="property">
            <column name="background_blue" not-null="true" />
        </property>
        <property name="canvasWidth" type="double" access="property">
            <column name="canvas_width" not-null="true" />
        </property>
        <property name="canvasHeight" type="double" access="property">
            <column name="canvas_height" not-null="true" />
        </property>
        <property name="lastCreationSerial" type="int" access="property">
        	<column name="last_creation_serial" not-null="true" />
        </property>
        <set name="canvasAttributes" inverse="true" table="canvasAttribute" cascade="all,delete-orphan" lazy="false">
            <key>
                <column name="canvas_id" not-null="true" />
            </key>
            <one-to-many class="org.pathwayeditor.businessobjects.hibernate.pojos.HibCanvasAttribute"/> 
        </set>
    </class>
    
    <query name="canvasExistsForMap"><![CDATA[
    		select count(*) from HibCanvas c  where c.mapINode = :inode and c.repositoryName = :repo
        ]]></query>
    <query name="loadCanvas"><![CDATA[
    		from HibCanvas c inner join fetch c.model m inner join fetch m.rootNode 
    		where c.repositoryName = :repo and c.mapINode = :inode
    	]]></query>
</hibernate-mapping>
